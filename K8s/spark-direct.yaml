apiVersion: v1
kind: Pod
metadata:
  name: spark-streaming
  namespace: default
spec:
  serviceAccountName: spark
  containers:
  - name: spark
    image: doyoomii/spark-k8s:latest
    imagePullPolicy: Always
    env:
    - name: KAFKA_BOOTSTRAP_SERVERS
      value: "streaming-cluster-kafka-bootstrap.kafka.svc.cluster.local:9092"
    command: ["/opt/spark/bin/spark-submit"]
    args:
      - "--master"
      - "local[*]"
      - "--packages"
      - "org.apache.spark:spark-sql-kafka-0-10_2.12:3.5.1"
      - "--conf"
      - "spark.driver.extraJavaOptions=-Divy.cache.dir=/tmp -Divy.home=/tmp"
      - "/opt/spark/app/user_activity_streaming.py"
    resources:
      requests:
        memory: "1Gi"
        cpu: "500m"
      limits:
        memory: "2Gi"
        cpu: "1000m"
  restartPolicy: OnFailure
